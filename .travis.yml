os:
  - linux
  - osx

language: cpp

compiler:
  - gcc

install:
  - sudo apt-get update
  - wget http://repo.continuum.io/miniconda/Miniconda-3.4.2-Linux-x86_64.sh -O miniconda.sh
  - bash miniconda.sh -b -p $HOME/miniconda
  - export PATH="$HOME/miniconda/bin:$PATH"
  - hash -r
  - conda config --set always_yes yes --set changeps1 no
  - conda update conda
  - conda info -a
  - conda install conda-build
  - conda create -n test-environment python=2.7 swig
  - source activate test-environment
  - conda build conda
  - conda install dfndarray --use-local

script:
  - cd test
  - "../waf configure --miniconda=$HOME/miniconda/envs/test-environment"
  - "../waf build"
  - build/main

env:
  global:
    secure: "f3KQa1k0SBCApTADwJVvtIW6ra19/ZCJD2f25ad1B9uqG65PeIrwIIO26p3jgFeKRQ3Zm8qXXFtVMMBSdVDFkA6aHMUiTGChVGiBRL5KIKJBDZN4GEfL3z7m4aFPpuui+AoR+uEb8sKdzAs1pF9cy2Oeb8UA1TiIhzEuZpAf4Zg="
    secure: "dYRfkS76pIBQ+o79FGeLGMVE1uEv2EXju7uQk9frHyqenSYAJqFtct/F8LZRaVrMqJ1dx3O5+RImFgHCrrmohAnf6IMtDkIjpA9ZVdj72Wp+De6SGZVTxJsSWN7V4gyn1C/mVktXQlCUStCpOyDqQXJhlZ4BLWHOh0MtPGqRT8Y="
    secure: "LsYrCO/40YhrvtbqTgJkcx2LT+1si4BPdunvH/gf0hs2/qlWhQ//sNorAo2b5Jfj/zmFKVM0/YPGkFrDZ9Uy0sGij8t4yEydtY/XSib9ChHqciiJ0FFeYgZWf2g//JXlk6ijoec+e+dnxKNt0+iZ5n8ocIAC1z24kb+9EYzkk/A="

after_success: curl --ftp-create-dirs --upload-file $HOME/miniconda/pkgs/dfndarray-0.0.0-1.tar.bz2 --user $FTP_USER:$FTP_PASSWORD ftp://$FTP_HOST/conda/dfndarray/dfndarray-0.0.0-1.tar.bz2
